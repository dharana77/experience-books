## 2. 데이터모델과 질의 언어


데이터 모델은 소프트웨어가 어떻게 작성됐는지 뿐만 아니라 해결하려는 문제를 어떻게 생각해야 하는지에 대해서도 지대한 영향을 미치기 때문에 중요하다.

애플리케이션에 적합한 데이터 모델을 선택하는 작업은 상당히 중요하다.

이번 장에서는 데이터 저장과 질의를 위한 다양한 범용 데이터 모델을 살펴본다.


### 관계형 모델과 문서 모델

오늘 날 가장 잘 알려진 데이터 모델은 SQL이다.
데치터는 관계로 구성되고 각 관계는 순서없는 튜플에서 로우 모음이다.

근원은 비즈니스 데이터 처리에 있으며 보통 트랜젝션 처리와 일괄 처리로 오늘날 관점에서는 일상적으로 수행되는 일이다.


#### NoSQL의 탄생

Not Only SQL
채택 이유에는 다음과 같은 다양한 원동력이 있다.
- 대규모 데이터셋이나 매우 높은 쓰기 처리량 달성을 관계형 데이터베이스보다 쉽게 할 수 있는 뛰어난 확장성의 필요
- 상용 데이터 베이스 제품보다 무료 오픈소스 소프트웨어에 대한 선호도 확산
- 관계형 모델에서 지원하지 않는 특수 질의 동작
- 관계형 스키마의 제한에 대한 불만과 더욱 동적이고 표현력이 풍부한 데이터 모델에 대한 바람

### 객체 관계형 불일치
오늘날 대부분 애플리케이션은 객체 지향 프로그래밍 언어로 개발한다.
이를 데이터 모델에 저장하려면 거추장스러운 전환 계층이 필요하다.
이런 모델 사이의 분리를 종종 `임피던스 불일치` 라고 부른다.


### 다대일과 다대다 관계

앞 절의 예제 2-1에서 region_id와 industry_id는 그레이터 시애틀 구역과, 자선활동이 아닌 ID로 주어졌다.
왜일까?

사용자 인터페이스에 지역과 업계를 입력할 수 있는 자유 텍스트 필드가 있다면

평문으로 저장하는 편이 합리적이지만 지리적 지역과 업계의 표준 목록으로 드롭다운 리스트나 자동완성 기능을 만들어 사용자가 선택하게 하는데는 다음과 같은 장점이 있다.

- 프로필 간 일관된 스타일과 철자
- 모호함 회피(예를 들어 이름이 같은 여러 도시가 있는 경우)
- 갱신의 편의성, 이름이 한 곳에만 저장되므로 이름을 변경해야 하는 경우 전반적으로 갱신하기 쉽다. (예를 들어 정치적 사건으로 도시 이름이 변경되는 경우)
- 현지화 지원. 사이트를 다른 언어로 번역할 때 표준 목록을 현지화해 지역과 업계를 사이트를 보는 사람의 언어로 표시할 수 있다.
- 더 나은 검색, 예를 들어 워싱턴 주에 있는 자선가를 검색하려 할 때 지역 목록에 시애틀이 워싱턴에 있다는 사실을 부호화
  - (그레이터 시애틀 구역 문자열로는 워싱턴을 식별하지 못함) 할 수 있기 때문에 원하는 프로필을 찾을 수 있다.

ID나 텍스트 문자열의 저장 여부는 중복의 문제다.
ID를 사용하는 경우 (자선활동이라는 단어처럼) 사람에게 의미 있는 정보는 한 곳에만 저장하고
그것을 참조하는 모든 것은 ID를 사용한다.
텍스트를 직접 저장한다면 그것을 사용하는 모든 레코드에서 사람을 의미하는 정보를 중복해서 저장하게 된다.

ID를 사용하는 장점으로 ID자체는 아무런 의미가 없기 때문에 변경할 필요가 없다.
즉 식별 정보를 변경해도 ID는 동일하게 유지할 수 있다.
하지만 의미를 가지는 경우라면 미래에 언젠가는 ID를 변경해야 할 수도 있다.
만약 정보가 중복돼 있으면 모든 중복 항목을 변경해야 한다.
이것은 쓰기 오버헤드와 불일치(정보의 일부 중복은 갱신됐지만 다른 중복 항목이 갱신되지 않음)
위험이 있다.

이런 중복을 제거하는 일이 데이터베이스의 정규화 이면에 놓인 핵심 개념이다.

중복된 데이터를 정규화하려면 다대일 관계
(많은 사람들은 한 특정 지역에 살고 많은 사람들은 한 특정 업계에서 일한다)가 필요한데 
안타깝게도 다대일 관계는 문서 모델에 적합하지 ㅇ낳다.

관계형 데이터베이스에서는 조인이 쉽기 떄문에 ID로 다른 테이블의 로우를 참조하는 방식은 일반적이다.
문서 데이터베이스에서는 일대다 트리 구조를 위해 조인이 필요하지 않지만 조인에 대한 지원이 보통 약하다.

데이터 베이스 자체가 조인을 지원하지 않으면 데이터베이스에 대한 다중 질의를 만들어서 애플리케이션 코드에서 조인을 흉내내야 한다.

