

### 5.3.6 깃과 함께 스프링 클라우드 컨피그 사용
파일 시스템을 스프링 클라우드 컨피그 서버의 백엔드 저장소로 사용하는 것은 클라우드 기반 애플리케이션에 실용적이지 못하다.

개발 팀이 컨피그 서버의 모든 인스턴스에 마운트 되는 공유 파일 시스템을 설정하고 관리해야 하며,
컨피그 서버는 애플리케이션 구성 프로퍼티를 호스팅하는데 다양한 백엔드 저장소와 통합될 수 있기 때문

우리가 성공적으로 사용한 한가지 방법은 깃 소스 제어 저장소와 함께 스프링 클라우드 컨피그 서버를 사용한 것

spring.profiles.active

spring.cloud.config.server.git

spring.cloud.config.server.git.uri - 연결하려는 깃 리포지토리 url을 제공

spring.cloud.config.server.git.searchPaths
클라우드 컨피그 서버가 부팅될때 검색될 깃 리포지토리의 상대 경로를 스프링 컨피그에 지정
파일 시스템 구성 정보처럼

spring.cloud.config.server.git.searchPaths
값은 구성 서비스에서 호스팅되는 각 서비스를 쉼표로 구분해서 표기


### 5.3.7 볼트와 스프링 클라우드 컨피그 서비스 통합


다른 백엔드 저장소로 하시코프 볼트


시크릿에 안전 접근

볼트 프로파일 추가

볼트와 통합하기 위해 도커를 사용

VALUT_DEV_ROOT_TOKEN_I

VALUT_DEV_LISTEN_ADDRESS


### 5.3.8 볼트 UI

볼트는 시크릿 생성 과정을 도와주는 통합 인터페이스를 제공

http://0.0.0.0:8200/ui/valut/auth

docker run 명령에서 VALUT_DEV_LISTEN_ADDRESS

매개변수로 설정됨

5.4 중요한 구성 정보 보호

기본적으로 스프링 클라우드 컨피그 서버는 애플리케이션 구성 파일 안의 모든 프로퍼티를 평문으로 저장한ㄷ.
여기에는 데이터베이스 자격 증명 등 중요 정보도 포함되어 있다.


5.4.2 프로퍼티 암호화와 복호화
o-stock 데이터에 액세스 하는데 사용하는 라이선싱 서비스의
postgres 데이터베이스 패스워드를 암호화함

spirng.datasource.password 라는 프로퍼티 값은 현재 평문으로 되어 있음


### 5.5 마치며

애플리케이션 구성 관리는
평범한 주제로 보이지만 클라우드 기반 환경에서는 매우 주용하다.

애플리케이션과 애플리케이션이 실행된 서버는 불변해야 하며
서버를 다른 환경으로 승격할 때는 절대 수동으로 구성하지
않는 것이 중요하다.

이 방식은 프로퍼티 파일과 함께 애플리케이션 산출물
(예를 들어 JAR 또는 WAR 파일)을 ‘고정’ 환경에 배포하는
전통적인 배포 모델과는 상충된다.

하지만 클라우드 기반 모델에서는 애플리케이션 구성 데이터를
애플리케이션과 완전히 분리해야 한다.

적절한 구성 데이터가 실행 중 주입되어 동일한 서버와 애플리케이션 산출물이 모든 환경에 일관된 방식으로 승격될 수 있다.

### 5.6 요약

스프링 클라우드 구성 서버(컨피그 서버로 알려진)를 사용하며 애플리케이션 프로퍼티 값을 환경별로 설정할 수 있다.

스프링은 서비스 시작할때 프로파일을 사용하여 스프링 클라우드 컨피그 서비스에서 조회할 환경 프로퍼티들을 결정한다.

스프링 클라우드 컨피그 서비스는 파일 또는 깃, 볼트 기반의 애플리케이션 구성 저장소를 사용하여 애플리케이션 프로퍼티를 저장할 수 있다.

스프링 클라우드 컨피그 서비스는 대칭 및 비대칭 암호화를 사용하여 중요한 정보를 암호화 할 수 있다.
